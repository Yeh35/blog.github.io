<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>다이나믹 프록시 :: sango.h — Development blog</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="사전 지식  java Class loading (실행과정) java 리플렉션  프록시 패턴  프록시와 리얼 서브젝트가 같은 인터페이스를 상속받고 클라이언트는 인터페이스를 프록시 타입으로 선언해서 사용한다. 프록시에서는 앞뒤로 부가 가능을 추가하고 리얼 서브젝트를 호출 한다.   결과적으로 리얼 서브젝트는 제공하는 핵심기능을 유지하며 코드 변경 없이 부가적인 기능(트렌젝션, 접근 제어, 로깅)을 제공할 수 있다.  다이나믹 프록시  테스트 코드 실행을 위해서 junit4를 사용할 것이다.    프록시 패턴 인터페이스가 필요하듯 인터페이스를 추가한다"/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<meta name="google-site-verification" content="m5phnpm4z3C-bApLVELFYLomqYrSOnblcuSgJk1YFoQ" />

<link rel="canonical" href="https://yeh35.github.io/blog.github.io/posts/documents/java/%EB%8B%A4%EC%9D%B4%EB%82%98%EB%AF%B9_%ED%94%84%EB%A1%9D%EC%8B%9C/" />





<link rel="stylesheet" href="https://yeh35.github.io/blog.github.io/assets/style.css">


<link rel="stylesheet" href="https://yeh35.github.io/blog.github.io/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://yeh35.github.io/blog.github.io/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="https://yeh35.github.io/blog.github.io/img/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="다이나믹 프록시"/>
<meta name="twitter:description" content="사전 지식  java Class loading (실행과정) java 리플렉션  프록시 패턴  프록시와 리얼 서브젝트가 같은 인터페이스를 상속받고 클라이언트는 인터페이스를 프록시 타입으로 선언해서 사용한다. 프록시에서는 앞뒤로 부가 가능을 추가하고 리얼 서브젝트를 호출 한다.   결과적으로 리얼 서브젝트는 제공하는 핵심기능을 유지하며 코드 변경 없이 부가적인 기능(트렌젝션, 접근 제어, 로깅)을 제공할 수 있다.  다이나믹 프록시  테스트 코드 실행을 위해서 junit4를 사용할 것이다.    프록시 패턴 인터페이스가 필요하듯 인터페이스를 추가한다"/>



<meta property="og:title" content="다이나믹 프록시" />
<meta property="og:description" content="사전 지식  java Class loading (실행과정) java 리플렉션  프록시 패턴  프록시와 리얼 서브젝트가 같은 인터페이스를 상속받고 클라이언트는 인터페이스를 프록시 타입으로 선언해서 사용한다. 프록시에서는 앞뒤로 부가 가능을 추가하고 리얼 서브젝트를 호출 한다.   결과적으로 리얼 서브젝트는 제공하는 핵심기능을 유지하며 코드 변경 없이 부가적인 기능(트렌젝션, 접근 제어, 로깅)을 제공할 수 있다.  다이나믹 프록시  테스트 코드 실행을 위해서 junit4를 사용할 것이다.    프록시 패턴 인터페이스가 필요하듯 인터페이스를 추가한다" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yeh35.github.io/blog.github.io/posts/documents/java/%EB%8B%A4%EC%9D%B4%EB%82%98%EB%AF%B9_%ED%94%84%EB%A1%9D%EC%8B%9C/" />
<meta property="article:published_time" content="2020-05-10T12:40:07+09:00" />
<meta property="article:modified_time" content="2020-05-10T12:40:07+09:00" /><meta property="og:site_name" content="sango.h" />










  </head>
  <body class="">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="https://yeh35.github.io/blog.github.io/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">sango.h</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/blog.github.io/about">About</a></li>
        
      
        
          <li><a href="/blog.github.io/blog">Blog</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/blog.github.io/about">About</a></li>
      
    
      
        <li><a href="/blog.github.io/blog">Blog</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h2 class="post-title"><a href="https://yeh35.github.io/blog.github.io/posts/documents/java/%EB%8B%A4%EC%9D%B4%EB%82%98%EB%AF%B9_%ED%94%84%EB%A1%9D%EC%8B%9C/">다이나믹 프록시</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
          2020-05-10
        </span>

        
          
        
      

      
      
        <span class="post-read-time">— 2 min read</span>
      
    </div>

    

    

    <div class="post-content">
      <h2 id="사전-지식">사전 지식</h2>
<ul>
<li>java Class loading (실행과정)</li>
<li>java 리플렉션</li>
</ul>
<h2 id="프록시-패턴">프록시 패턴</h2>
<p><img src="https://yeh35.github.io/blog.github.io/img/documents/proxy_pattern.PNG" alt="proxy pattern"></p>
<ol>
<li>프록시와 리얼 서브젝트가 같은 인터페이스를 상속받고 클라이언트는 인터페이스를 프록시 타입으로 선언해서 사용한다.</li>
<li>프록시에서는 앞뒤로 부가 가능을 추가하고 리얼 서브젝트를 호출 한다.</li>
</ol>
<ul>
<li>결과적으로 리얼 서브젝트는 제공하는 핵심기능을 유지하며 코드 변경 없이 부가적인 기능(트렌젝션, 접근 제어, 로깅)을 제공할 수 있다.</li>
</ul>
<h2 id="다이나믹-프록시">다이나믹 프록시</h2>
<ul>
<li>테스트 코드 실행을 위해서 junit4를 사용할 것이다.</li>
</ul>
<ol>
<li>
<p>프록시 패턴 인터페이스가 필요하듯 인터페이스를 추가한다</p>
<pre><code>public interface SomethingService {

    @MorningGreetings
    public void printName(String name);

    public void printinformation(String information);
}
</code></pre></li>
<li>
<p>특정한 메소드에만 프록시 기능을 추가하고 싶기 떄문에 어노테이션을 추가하자</p>
<pre><code>@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface MorningGreetings {}
</code></pre></li>
<li>
<p>real 서브젝트를 만들자</p>
<pre><code>public class SomethingServiceImpl implements SomethingService {

    @Override
    public void printName(String name) {
        System.out.println(name);
    }

    @Override
    public void printinformation(String information) {
        System.out.println(information);
    }
}
</code></pre></li>
<li>
<p>리얼 서브젝트를 감싸는 프록시 테스트할 코드를 작성하자</p>
<pre><code>public class SomethingServiceProxyTest {

    public SomethingService somethingService
            = (SomethingService) Proxy.newProxyInstance(SomethingService.class.getClassLoader(),
                new Class[]{SomethingService.class},
            new InvocationHandler() {
                SomethingService somethingService = new SomethingServiceImpl();

                @Override
                public Object invoke(Object o, Method method, Object[] objects) throws Throwable {

                    MorningGreetings greetingAnocation = method.getAnnotation(MorningGreetings.class);

                    if (greetingAnocation != null) {
                        System.out.print(&quot;Hi,&quot;);
                        Object realInvoke = method.invoke(somethingService, objects);
                        System.out.println(&quot;good morning&quot;);
                        return realInvoke;
                    }

                    return method.invoke(somethingService, objects);
                }
            });

    @Test
    public void TestPrintName() {
        somethingService.printName(&quot;dobby&quot;);
        somethingService.printinformation(&quot;dobby is cute&quot;);
    }
}
</code></pre><ul>
<li>java.lang.reflect.Proxy라는 API를 이용해서 프락시를 만들었다.</li>
<li>결과 값은&hellip;
<pre><code>Hi,dobby
good morning
dobby is cute
</code></pre></li>
</ul>
</li>
</ol>
<h2 id="java-기본-api로는-class-기반의-프록시를-못만들어준다">java 기본 API로는 class 기반의 프록시를 못만들어준다.</h2>
<ul>
<li>무조건 interface가 필요
<ul>
<li>class로 하게 되면 &ldquo;is not an interface&quot;라는 에러메시지가 뜬다.</li>
</ul>
</li>
<li>class 기반 프록시를 하고 싶다면 추가 라이브러리가 필요하다.</li>
</ul>
<h3 id="cglib-추천">cglib (추천)</h3>
<ul>
<li><a href="https://github.com/cglib/cglib/wiki">https://github.com/cglib/cglib/wiki</a></li>
<li>spring 내부에서도 사용하는 라이브러리</li>
<li>단 하위 호환성이 좋지 않아서 각 프로젝트별로 가지고 있는 것이 좋음</li>
</ul>
<h3 id="bytebuddy">ByteBuddy</h3>
<ul>
<li><a href="https://bytebuddy.net/#/">https://bytebuddy.net/#/</a></li>
<li>바이트 코드 조작 뿐 아니라 런타임(다이나믹) 프록시를 만들 때도 사용가능</li>
<li>서브클래스를 만드는 방법
<ul>
<li>private 생성자만 있는 경우는 사용 못함</li>
<li>final class인 경우는 사용 못함</li>
</ul>
</li>
</ul>
<h2 id="다이나믹-프록시를-사용하는-곳">다이나믹 프록시를 사용하는 곳</h2>
<ul>
<li>스프링 데이터 JPA</li>
<li>스프링 AOP</li>
<li>Mockito</li>
<li>하이버네이트 lazy initialzation</li>
<li>&hellip; 등등</li>
</ul>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h">Read other posts</span>
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="https://yeh35.github.io/blog.github.io/posts/documents/web/what_is_rest_api/">
                  <span class="button__icon">←</span>
                  <span class="button__text">What is REST API(그런 REST API로 괜찮은가)</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="https://yeh35.github.io/blog.github.io/posts/documents/english/%EB%AC%B8%EC%9E%A5-%EC%84%B1%EB%B6%84%EA%B3%BC-%EB%AC%B8%EC%9E%A5-%ED%98%95%EC%8B%9D/">
                  <span class="button__text">문장 성분과 문장 형식</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    


    
      
        

      
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a href="https://yeh35.github.io/blog.github.io/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>
</span>
    <span class="logo__text">sango.h</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span>© 2020 Powered by <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span>
        <span>Theme created by <a href="https://twitter.com/panr" target="_blank" rel="noopener">panr</a></span>
      </div>
    
  </div>
</footer>

<script src="https://yeh35.github.io/blog.github.io/assets/main.js"></script>
<script src="https://yeh35.github.io/blog.github.io/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
